---
description: Investigate and shape a feature, resolve uncertainties, slice into work items (table only), then update feature overview.md and (when needed) design.md.
---

## User Input

```text
$ARGUMENTS
```

You **MUST** treat user input as the *feature link* (or feature slug/path) that identifies what to plan.

Example arguments:
```text
persistence-layer/ingestion-pipeline
docs-ai/docs/initiatives/persistence-layer/features/ingestion-pipeline
```

## When to use this (quick routing)

If the user is starting from a fuzzy goal (“I want something done”) and you don’t yet have a stable feature slug/path (and expect to update `roadmap.md` / `delivery-map.md` and create new work items), prefer starting with:
- `planning-intake`

## Goal

Take a feature from “idea/design draft” to “ready to execute via work items” by:

1. Investigating feature context and constraints (initiative goals, existing design decisions)
2. Surfacing and resolving material uncertainties (ownership, interfaces, semantics)
3. Producing a clear work-item slicing proposal (smallest safe vertical slices)
4. Updating feature `overview.md` (and `design.md` when needed) to reflect the validated shape

Important: you do **NOT** create work-item folders or `spec.md` files in this prompt.
You only update the feature’s **Work Items table** to reflect the agreed slicing.

Do **not** implement code in this run.

This task is **interactive**: if you need clarification, you MUST ask and wait.

## Decision Granularity (Non-Negotiable)

This prompt operates at the **feature** level.

You MUST lock down only feature-level decisions needed for safe slicing:
- feature ownership boundaries (what it owns vs what it calls/consumes)
- public/interface expectations at a semantic level (what inputs/outputs are, not exact signatures unless required)
- key semantics/invariants that would change slicing (e.g., ordering/tie-break rules, consistency expectations)
- integration points (what we depend on / what depends on us)

You MUST NOT lock down work-item implementation details (exact code edits, internal algorithms, migration mechanics) unless that detail is required to define a slice boundary or an invariant.
Lower-level detail belongs in the work item `spec.md` and the `plan.md` generated by `work-item-plan`.

## Second-order Requirements Sweep (Non-Negotiable; non-checklist)

Before proposing a Work Items table update, you MUST run a **second-order requirements sweep** to avoid “slicing the obvious” while missing what makes the feature actually usable/shippable.

This is intentionally not a fixed checklist. Use judgment and the existing docs to identify likely missing-but-required work around the feature goal (the kind of thing that would otherwise be discovered mid-implementation).

This sweep MUST also consider the **experience bar**: whether the end result should be modern, nice to use, and simple (not merely functional).

If any potentially-missing area would materially affect slicing or acceptance criteria and is not already decided in existing docs, you MUST ask the user (one question at a time) before editing feature docs.

## Interaction Default (Important)

Default behavior is **ledger-then-question**:

- In your **first** response, you MUST:
  1. Provide the **Context Read Ledger** (file paths only, plus 1-line “why this matters” per doc), THEN
  2. Ask **ONE** question using **Question Format (MANDATORY)**.
- Only skip the initial question if the user explicitly says “skip questions” / “assume defaults”.

If you have not asked the user at least one question in this thread, you must not edit docs yet.

## Output Constraint (Non-Negotiable)

Do NOT paste full `overview.md` / `design.md` content in chat.

- In chat: provide only a brief outline (max 10 bullets), plus the required **Decision Confirmation Table** when asserting **“No blocking questions remain”**, plus the single pending question (if any).
- Write changes to feature docs only after Hard Gate (A) is satisfied.

## Documentation Stewardship (Non-Negotiable)

After Hard Gate (A) is satisfied and before making any edits under `docs-ai/docs/`, you MUST use the `documentation-stewardship` skill and follow its “STOP - Before You Edit” checklist.

If `documentation-stewardship` conflicts with this prompt, you MUST treat that as a blocking issue and ask the user for clarification before editing.

## Work Items Table Convention (Non-Negotiable)

When updating the feature `overview.md`, the **Work Items** table MUST use this exact shape:

```md
| Work Item | Description | Status |
|-----------|-------------|--------|
| some-work-item-slug | One-line description | planned |
```

Rules:
- **Work Item** is a kebab-case slug (matches the work-item folder name once created).
- **Description** is a single line and may carry qualifiers like `Post-MVP:` or `Merged into <other-item>:` (do not put qualifiers in the Status cell).
- **Status** MUST be one of: `planned`, `in-progress`, `done`, `deferred`.
  - Use `deferred` for explicitly post-MVP or intentionally out-of-scope items.
  - Use `planned` for in-scope but not started yet.

## Existing Docs Compatibility (Important)

When touching an existing feature `overview.md`, make the smallest coherent change:
- Do not “mass normalize” historical rows/status values unless the user explicitly asks.
- If you encounter legacy status strings in the table, fix only the rows you add/change, and call out the mismatch for follow-up.

## What counts as “blocking” for feature docs

An open question is **BLOCKING** only if it prevents:
- producing a coherent Work Items table (we don’t know slice boundaries), or
- avoiding contradictory/unstable slicing (major interface/ownership ambiguity).

Non-blocking uncertainties MUST be captured in feature docs (usually `design.md` or a short “Open Questions” section), but they do not prevent updating the Work Items table.

## What counts as “material uncertainty”

A decision is **MATERIAL** if it affects any of:
- Public API shape (endpoints, payloads, contract models)
- Query semantics (filtering, ordering, tie-breaks)
- Consistency/transaction boundaries
- Schema invariants or ownership (which feature “owns” which tables/columns)
- Cross-feature integration (inputs/outputs, dependency ordering)
- Security/privacy posture

If any material uncertainty exists, you MUST ask the user (one question at a time) before editing docs.

## Decision Confirmation Rule (Non-Negotiable)

A material decision is **NOT resolved** unless it is either:

1) Explicitly stated in an existing spec/design/ADR, OR
2) Confirmed by the user in this thread (A/B/C or “yes”).

If a material decision would rely on a default, assumption, “common sense”, or guess, it counts as an **open question** and you MUST trigger Hard Gate (B).

## Hard Gate (Non-Negotiable)

Before writing/updating feature docs, you MUST either:

- (A) State: **“No blocking questions remain”** and include a small **Decision Confirmation Table** (feature-level only):
  - Decision
  - Chosen option
  - Source: “design/spec/ADR” / “roadmap.md” / “user-confirmed in chat”

OR

- (B) STOP and ask **ONE blocking** question (using **Question Format (MANDATORY)**). Do not edit files until the user answers.

## Question Format (MANDATORY)

Use this format ONLY for questions you ask the user to proceed.

You MUST NOT ask your first **Question Format** question until after you have completed the **Context Read Ledger** (see Execution Step 2).

```md
**Question:** <the single question you need answered>

**Recommended:** Option A — <1–2 sentence reasoning>

| Option | Description |
|--------|-------------|----------------|
| A | ... |
| B | ... |
| C | ... |

Reply with A/B/C, or say “yes” to accept the recommendation.
```

Only ask **ONE** question per message. If multiple uncertainties exist, ask about the single highest-impact one first and list the others as “Pending (will ask next)”.

## Execution Steps

### 1) Resolve feature directory + docs

Resolve `$ARGUMENTS` to a single `FEATURE_DIR`:

- Preferred slug form: `{initiative}/{feature}` (e.g., `persistence-layer/ingestion-pipeline`)
  - Map to: `docs-ai/docs/initiatives/<initiative>/features/<feature>/`
- Also acceptable: direct path to `docs-ai/docs/initiatives/<initiative>/features/<feature>/`

Then define:
- `FEATURE_OVERVIEW = FEATURE_DIR/overview.md`
- `FEATURE_DESIGN = FEATURE_DIR/design.md`
- `INITIATIVE_DIR = docs-ai/docs/initiatives/<initiative>/`
- `INITIATIVE_OVERVIEW = INITIATIVE_DIR/overview.md`

If multiple candidates exist, STOP and ask the user to choose the correct one.

### 2) Load minimal context (progressive disclosure)

1. Read `docs-ai/docs/roadmap.md` first.
2. Read `INITIATIVE_OVERVIEW` (if it exists) for context.
3. Read initiative-level integration docs (when they exist) so you don’t duplicate cross-cutting guidance:
   - `INITIATIVE_DIR/integration/overview.md`
   - Any linked integration docs that mention this feature or its interfaces
4. Read `FEATURE_OVERVIEW` and `FEATURE_DESIGN` if they exist.
5. Scan `FEATURE_DIR/work-items/` (existing work-item slugs) and compare to the Work Items table.
6. If any work-item folders already exist, you MUST read the `spec.md` for:
   - any work items that are `in-progress` / `done` (to avoid re-slicing already-shipped boundaries), and
   - any work items referenced by `FEATURE_OVERVIEW`, `FEATURE_DESIGN`, or initiative integration docs.

#### Context Read Ledger (Required)

In your first response, include a short “Context Read” list (file paths only) for the docs you actually opened. Do NOT paste doc contents.

### 3) Shape the feature + slice into work items (when Hard Gate A is satisfied)

## Integration Placement Rule (Non-Negotiable)

When writing about integration:
- Feature `overview.md` should contain only feature-specific integration points and must be brief.
- Integration guidance that spans **2+ features** must live at the initiative level under `docs-ai/docs/initiatives/<initiative>/integration/` (create/update an `overview.md` index there if needed), and feature docs must link to it.
- Do not “smuggle” cross-cutting integration architecture into a single feature overview.

Update `FEATURE_OVERVIEW` to include:
- Goal
- Work Items table (the sliced queue)
- Integration points (links, not duplicated specs)
- Open Questions (explicit list, when useful)

Update `FEATURE_DESIGN` only when needed to capture material decisions and rationale.

Work item slicing requirements:
- Each work item is small enough to implement in a focused session.
- Prefer vertical slices over “big bang”.
- Avoid parallel slices in known conflict zones.
- Do NOT create work-item directories; only update the Work Items table with:
  - slug
  - 1-line description
  - status

End by stating which work item should be specified next via `work-item-spec`.

## Cross-Doc Impact (Non-Negotiable)

When you edit a feature doc, you MUST check and update any directly affected documents, not just the single file you started from. Typical impacted docs include:
- initiative `overview.md` (feature list/status consistency)
- other feature docs that link to or depend on your updated interfaces/decisions
- initiative-level integration docs when the integration story becomes cross-cutting

Prefer links over duplication, and remove/replace outdated text rather than appending competing guidance.
