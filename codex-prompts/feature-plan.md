---
description: Investigate and shape a feature, resolve uncertainties, slice into work items (table only), then update feature overview.md and (when needed) design.md.
---

## User Input

```text
$ARGUMENTS
```

You **MUST** treat `$ARGUMENTS` as the *feature link* (or feature slug/path) that identifies what to plan.

Example arguments:
```text
persistence-layer/ingestion-pipeline
docs-ai/docs/initiatives/persistence-layer/features/ingestion-pipeline
```

## Goal

Take a feature from “idea/design draft” to “ready to execute via work items” by:

1. Investigating feature context and constraints (initiative goals, existing design decisions)
2. Surfacing and resolving material uncertainties (ownership, interfaces, semantics)
3. Producing a clear work-item slicing proposal (smallest safe vertical slices)
4. Updating feature `overview.md` (and `design.md` when needed) to reflect the validated shape

Important: you do **NOT** create work-item folders or `spec.md` files in this prompt.
You only update the feature’s **Work Items table** to reflect the agreed slicing.

Do **not** implement code in this run.

This task is **interactive**: if you need clarification, you MUST ask and wait.

## Decision Granularity (Non-Negotiable)

This prompt operates at the **feature** level.

You MUST lock down only feature-level decisions needed for safe slicing:
- feature ownership boundaries (what it owns vs what it calls/consumes)
- public/interface expectations at a semantic level (what inputs/outputs are, not exact signatures unless required)
- key semantics/invariants that would change slicing (e.g., ordering/tie-break rules, consistency expectations)
- integration points (what we depend on / what depends on us)

You MUST NOT lock down work-item implementation details (exact code edits, internal algorithms, migration mechanics) unless that detail is required to define a slice boundary or an invariant.
Lower-level detail belongs in the work item `spec.md` and the `plan.md` generated by `work-item-plan`.

## Interaction Default (Important)

Default behavior is **question-first**:

- In your **first** response, ask **ONE** question using **Question Format (MANDATORY)**.
- Only skip the initial question if the user explicitly says “skip questions” / “assume defaults”.

If you have not asked the user at least one question in this thread, you must not edit docs yet.

## Output Constraint (Non-Negotiable)

Do NOT paste full `overview.md` / `design.md` content in chat.

- In chat: provide only a brief outline (max 10 bullets), plus the required **Decision Confirmation Table** when asserting **“No open questions remain”**, plus the single pending question (if any).
- Write changes to feature docs only after Hard Gate (A) is satisfied.

## Work Items Table Convention (Non-Negotiable)

When updating the feature `overview.md`, the **Work Items** table MUST use this exact shape:

```md
| Work Item | Description | Status |
|-----------|-------------|--------|
| some-work-item-slug | One-line description | planned |
```

Rules:
- **Work Item** is a kebab-case slug (matches the work-item folder name once created).
- **Description** is a single line and may carry qualifiers like `Post-MVP:` or `Merged into <other-item>:` (do not put qualifiers in the Status cell).
- **Status** MUST be one of: `planned`, `in-progress`, `done`, `deferred`.
  - Use `deferred` for explicitly post-MVP or intentionally out-of-scope items.
  - Use `planned` for in-scope but not started yet.

## Existing Docs Compatibility (Important)

When touching an existing feature `overview.md`, make the smallest coherent change:
- Do not “mass normalize” historical rows/status values unless the user explicitly asks.
- If you encounter legacy status strings in the table, fix only the rows you add/change, and call out the mismatch for follow-up.

## What counts as “blocking” for feature docs

An open question is **BLOCKING** only if it prevents:
- producing a coherent Work Items table (we don’t know slice boundaries), or
- avoiding contradictory/unstable slicing (major interface/ownership ambiguity).

Non-blocking uncertainties MUST be captured in feature docs (usually `design.md` or a short “Open Questions” section), but they do not prevent updating the Work Items table.

## What counts as “material uncertainty”

A decision is **MATERIAL** if it affects any of:
- Public API shape (endpoints, payloads, contract models)
- Query semantics (filtering, ordering, tie-breaks)
- Consistency/transaction boundaries
- Schema invariants or ownership (which feature “owns” which tables/columns)
- Cross-feature integration (inputs/outputs, dependency ordering)
- Security/privacy posture

If any material uncertainty exists, you MUST ask the user (one question at a time) before editing docs.

## Decision Confirmation Rule (Non-Negotiable)

A material decision is **NOT resolved** unless it is either:

1) Explicitly stated in an existing spec/design/ADR, OR
2) Confirmed by the user in this thread (A/B/C or “yes”).

If a material decision would rely on a default, assumption, “common sense”, or guess, it counts as an **open question** and you MUST trigger Hard Gate (B).

## Hard Gate (Non-Negotiable)

Before writing/updating feature docs, you MUST either:

- (A) State: **“No blocking questions remain”** and include a small **Decision Confirmation Table** (feature-level only):
  - Decision
  - Chosen option
  - Source: “design/spec/ADR” / “roadmap.md” / “user-confirmed in chat”

OR

- (B) STOP and ask **ONE blocking** question (using **Question Format (MANDATORY)**). Do not edit files until the user answers.

## Question Format (MANDATORY)

Use this format ONLY for questions you ask the user to proceed.

```md
**Question:** <the single question you need answered>

**Recommended:** Option A — <1–2 sentence reasoning>

| Option | Description |
|--------|-------------|----------------|
| A | ... |
| B | ... |
| C | ... |

Reply with A/B/C, or say “yes” to accept the recommendation.
```

Only ask **ONE** question per message. If multiple uncertainties exist, ask about the single highest-impact one first and list the others as “Pending (will ask next)”.

## Execution Steps

### 1) Resolve feature directory + docs

Resolve `$ARGUMENTS` to a single `FEATURE_DIR`:

- Preferred slug form: `{initiative}/{feature}` (e.g., `persistence-layer/ingestion-pipeline`)
  - Map to: `docs-ai/docs/initiatives/<initiative>/features/<feature>/`
- Also acceptable: direct path to `docs-ai/docs/initiatives/<initiative>/features/<feature>/`

Then define:
- `FEATURE_OVERVIEW = FEATURE_DIR/overview.md`
- `FEATURE_DESIGN = FEATURE_DIR/design.md`

If multiple candidates exist, STOP and ask the user to choose the correct one.

### 2) Load minimal context (progressive disclosure)

1. Read `docs-ai/docs/roadmap.md` first.
2. Read the initiative `overview.md` for context.
3. Read `FEATURE_OVERVIEW` and `FEATURE_DESIGN` if they exist.
4. Scan `FEATURE_DIR/work-items/` (existing work-item slugs) and compare to the Work Items table.

### 3) Shape the feature + slice into work items (when Hard Gate A is satisfied)

Update `FEATURE_OVERVIEW` to include:
- Goal
- Work Items table (the sliced queue)
- Integration points (links, not duplicated specs)
 - Open Questions (explicit list, when useful)

Update `FEATURE_DESIGN` only when needed to capture material decisions and rationale.

Work item slicing requirements:
- Each work item is small enough to implement in a focused session.
- Prefer vertical slices over “big bang”.
- Avoid parallel slices in known conflict zones.
- Do NOT create work-item directories; only update the Work Items table with:
  - slug
  - 1-line description
  - status

End by stating which work item should be specified next via `work-item-spec`.
